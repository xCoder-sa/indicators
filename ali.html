<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم فريق العمليات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* إعدادات أساسية */
        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fa;
            direction: rtl;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* لوحة التحكم الجانبية */
        .sidebar {
            width: 250px;
            background-color: #2d3436;
            color: #dfe6e9;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            transition: width 0.3s;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar .logo {
            text-align: center;
            font-size: 20px;
            margin-bottom: 30px;
            font-weight: bold;
            color: #dfe6e9;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        .sidebar ul li {
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }

        .sidebar ul li:hover, .sidebar ul li.active {
            background-color: #636e72;
        }

        .sidebar ul li i {
            margin-right: 15px; /* زيادة المسافة بين الأيقونة والنص */
            font-size: 18px;
        }

        /* المحتوى الرئيسي */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h2 {
            margin: 0;
            color: #2d3436;
        }

        /* النموذج */
        .form-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none; /* إخفاء النماذج بشكل افتراضي */
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section label {
            display: block;
            margin-bottom: 8px;
            color: #2d3436;
            font-weight: bold;
            font-size: 16px;
        }

        .form-section input[type="number"],
        .form-section input[type="text"],
        .form-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #b2bec3;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
            background-color: #dfe6e9;
            box-sizing: border-box; /* لضمان أن الحقول لا تتداخل مع حدود الجدول */
        }

        .form-section input[type="number"]:focus,
        .form-section input[type="text"]:focus,
        .form-section textarea:focus {
            border-color: #0984e3;
            outline: none;
            background-color: #ffffff;
        }

        .form-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .form-section table th,
        .form-section table td {
            border: 1px solid #b2bec3;
            padding: 12px;
            text-align: center;
            box-sizing: border-box; /* لضمان أن الخلايا لا تتداخل */
        }

        .form-section table th {
            background-color: #74b9ff;
            color: #ffffff;
        }

        .form-section button {
            padding: 10px 15px;
            background-color: #0984e3;
            border: none;
            border-radius: 6px;
            color: #ffffff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .form-section button:hover {
            background-color: #74b9ff;
        }

        /* زر الإرسال */
        .submit-btn {
            width: 100%;
            padding: 15px;
            background-color: #00b894;
            border: none;
            border-radius: 6px;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #55efc4;
        }

        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                height: 100%;
                z-index: 1000;
                left: -250px;
            }

            .sidebar.active {
                left: 0;
            }

            .sidebar.collapsed {
                left: -60px;
            }

            .main-content {
                padding: 20px 10px;
            }

            .hamburger-btn {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                background-color: #2d3436;
                color: #dfe6e9;
                border: none;
                padding: 10px;
                border-radius: 5px;
                cursor: pointer;
                z-index: 1100;
            }
        }

        @media (min-width: 769px) {
            .hamburger-btn {
                display: none;
            }
        }

        /* تحسينات إضافية */
        .form-section .section-title {
            background-color: #0984e3; /* لون خلفية متناسق */
            color: #ffffff;
            padding: 10px;
            border-radius: 6px;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .note {
            background-color: #f1f2f6; /* لون خلفي مختلف لتجنب التشابه مع مربعات الإدخال */
            padding: 10px;
            border-left: 4px solid #0984e3;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
            color: #2d3436;
        }

        /* تحسين حدود الجداول */
        table th, table td {
            border: 1px solid #b2bec3 !important;
        }

        /* إزالة تداخل النصوص */
        table input[type="number"], table input[type="text"] {
            width: 90%; /* تقليل العرض لتجنب تداخل الحدود */
        }

        /* تنسيق العناوين الرئيسية */
        .form-section h3 {
            font-size: 20px;
            color: #ffffff;
            margin-bottom: 15px;
            background-color: #0984e3;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        /* تنسيق ملاحظات التطبيقات في سطر واحد */
        .apps-note {
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>

    <!-- زر الهامبرجر للأجهزة الصغيرة -->
    <button class="hamburger-btn" id="hamburgerBtn"><i class="fas fa-bars"></i></button>

    <!-- لوحة التحكم الجانبية -->
    <div class="sidebar" id="sidebar">
        <div class="logo">لوحة التحكم</div>
        <ul>
            <li class="active" data-form="ambulanceTeam"><i class="fas fa-ambulance"></i> فريق الإسعاف الارضي</li>
            <li data-form="medicalTransferTeam"><i class="fas fa-stethoscope"></i> فريق الترحيل الطبي</li>
            <!-- يمكن إضافة عناصر جديدة هنا للنماذج المستقبلية -->
            <!-- مثال:
            <li data-form="anotherForm"><i class="fas fa-file-alt"></i> نموذج آخر</li>
            -->
        </ul>
    </div>

    <!-- المحتوى الرئيسي -->
    <div class="main-content">
        <div class="header">
            <h2>لوحة تحكم فريق العمليات</h2>
        </div>

        <!-- نموذج فريق الإسعاف الارضي -->
        <div class="form-container" id="ambulanceTeam" style="display: block;">
            <div class="form-section">
                <label for="total_service_providers">إجمالي مقدمي الخدمة الإسعافية:</label>
                <input type="number" id="total_service_providers" placeholder="إجمالي مقدمي الخدمة الإسعافية" required>
            </div>
            <div class="form-section">
                <label for="employees">الموظفين منهم:</label>
                <input type="number" id="employees" placeholder="عدد الموظفين" required>
            </div>
            <div class="form-section">
                <label for="volunteers">المتطوعين منهم:</label>
                <input type="number" id="volunteers" placeholder="عدد المتطوعين" required>
            </div>
            <div class="form-section">
                <label for="total_operational_units">إجمالي الوحدات التشغيلية:</label>
                <input type="number" id="total_operational_units" placeholder="إجمالي الوحدات التشغيلية" required>
            </div>
            <div class="form-section">
                <label for="male_teams">فرق راجلة:</label>
                <input type="number" id="male_teams" placeholder="عدد فرق راجلة" required>
            </div>
            <div class="form-section">
                <label for="mechanical_teams">فرق آليات:</label>
                <input type="number" id="mechanical_teams" placeholder="عدد فرق آليات" required>
            </div>
            <div class="form-section">
                <label for="vehicle_teams">فرق مركبات:</label>
                <input type="number" id="vehicle_teams" placeholder="عدد فرق مركبات" required>
            </div>
            <div class="form-section">
                <h3>توزيع الفرق بحسب مواقعها:</h3>
                <div class="sub-section">
                    <label for="haram">الحرم المكي:</label>
                    <input type="number" id="haram" placeholder="عدد الفرق في الحرم المكي" required>
                </div>
                <div class="sub-section">
                    <label for="holy_capital">العاصمة المقدسة:</label>
                    <input type="number" id="holy_capital" placeholder="عدد الفرق في العاصمة المقدسة" required>
                </div>
                <div class="sub-section">
                    <label for="muzdalifah">مزدلفة:</label>
                    <input type="number" id="muzdalifah" placeholder="عدد الفرق في مزدلفة" required>
                </div>
                <div class="sub-section">
                    <label for="arafat">عرفات:</label>
                    <input type="number" id="arafat" placeholder="عدد الفرق في عرفات" required>
                </div>
                <div class="sub-section">
                    <label for="mina">منى:</label>
                    <input type="number" id="mina" placeholder="عدد الفرق في منى" required>
                </div>
                <div class="sub-section">
                    <label for="hajj_road">طريق الحاج:</label>
                    <input type="number" id="hajj_road" placeholder="عدد الفرق في طريق الحاج" required>
                </div>
            </div>
            <div class="form-section">
                <h3>أهداف المناوبة:</h3>
                <table>
                    <thead>
                        <tr>
                            <th>الهدف</th>
                            <th>التحديث</th>
                        </tr>
                    </thead>
                    <tbody id="shift_goals">
                        <tr>
                            <td><input type="text" placeholder="الهدف" required></td>
                            <td><input type="text" placeholder="التحديث" required></td>
                        </tr>
                        <tr>
                            <td><input type="text" placeholder="الهدف" required></td>
                            <td><input type="text" placeholder="التحديث" required></td>
                        </tr>
                        <!-- يمكن إضافة المزيد من الصفوف حسب الحاجة -->
                    </tbody>
                </table>
                <button type="button" onclick="addShiftGoal()">إضافة هدف آخر</button>
            </div>
            <div class="form-section">
                <h3>ملاحظات المناوبة:</h3>
                <textarea id="shift_notes" rows="4" placeholder="ملاحظات المناوبة" required></textarea>
            </div>
            <div class="form-section">
                <h3>الاسم:</h3>
                <input type="text" id="name" placeholder="أدخل اسمك" required>
            </div>
            <button type="button" class="submit-btn" onclick="submitForm()">إرسال النموذج</button>
        </div>

        <!-- نموذج فريق الترحيل الطبي -->
        <div class="form-container" id="medicalTransferTeam">
            <div class="form-section">
                <label for="total_calls">إجمالي المكالمات:</label>
                <input type="number" id="total_calls" placeholder="إجمالي المكالمات" required>
            </div>
            <div class="form-section">
                <label for="received_calls">المكالمات المستلمة:</label>
                <input type="number" id="received_calls" placeholder="المكالمات المستلمة" required>
            </div>
            <div class="form-section">
                <label for="missed_calls_percentage">نسبة المكالمات الفائتة:</label>
                <input type="text" id="missed_calls_percentage" placeholder="نسبة المكالمات الفائتة" required>
            </div>
            <div class="form-section">
                <h3>بلاغات</h3>
                <div class="sub-section">
                    <label for="reports_997">بلاغات 997:</label>
                    <input type="number" id="reports_997" placeholder="بلاغات 997" required>
                </div>
                <div class="sub-section">
                    <label for="reports_911">بلاغات 911:</label>
                    <input type="number" id="reports_911" placeholder="بلاغات 911" required>
                </div>
                <div class="sub-section">
                    <label for="reports_apps">بلاغات التطبيقات:</label>
                    <input type="number" id="reports_apps" placeholder="بلاغات التطبيقات" required>
                </div>
            </div>
            <div class="form-section">
                <label for="patients_responsive">عدد المرضى المستجاب لهم:</label>
                <input type="number" id="patients_responsive" placeholder="عدد المرضى المستجاب لهم" required>
            </div>
            <div class="form-section">
                <div class="apps-note">
                    <label>التطبيقات:</label>
                    <p class="note">المسعف الإلكتروني توكلنا، أسعفني، صحتي، عقد</p>
                </div>
            </div>
            <div class="form-section">
                <h3>مؤشرات الترحيل الطبي</h3>
                <p class="note">إجمالي عدد البلاغات للعاصمة المقدسة والحرم والمشاعر حسب تصنيف الترحيل الطبي.</p>
                <table id="indicators_table">
                    <thead>
                        <tr>
                            <th>الفريق</th>
                            <th>المستلمة</th>
                            <th>الملغاة</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ECHO</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>DELTA</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>BRAVO</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>CHARLY</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>ALPHA</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>OMEGA</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                        <tr>
                            <td>VECTOR</td>
                            <td><input type="number" placeholder="المستلمة" required></td>
                            <td><input type="number" placeholder="الملغاة" required></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-section">
                <label for="proqa_percentage">نسبة الالتزام ProQA:</label>
                <input type="text" id="proqa_percentage" placeholder="نسبة الالتزام ProQA" required>
            </div>
            <div class="form-section">
                <label for="processed_calls_percentage">نسبة المكالمات التي تم معالجتها خلال 90 ثانية:</label>
                <input type="text" id="processed_calls_percentage" placeholder="نسبة المكالمات التي تم معالجتها خلال 90 ثانية" required>
            </div>
            <div class="form-section">
                <label for="vector_reports_percentage">نسبة بلاغات VECTOR من اجمالي البلاغات:</label>
                <input type="text" id="vector_reports_percentage" placeholder="نسبة بلاغات VECTOR من اجمالي البلاغات" required>
            </div>
            <div class="form-section">
                <h3>بلاغات 911</h3>
                <div class="sub-section">
                    <label for="total_reports_911">إجمالي البلاغات الواردة من 911:</label>
                    <input type="number" id="total_reports_911" placeholder="إجمالي البلاغات الواردة من 911" required>
                </div>
                <div class="sub-section">
                    <label for="responded_reports_911">اجمالي بلاغات 911 المستجاب لها:</label>
                    <input type="number" id="responded_reports_911" placeholder="اجمالي بلاغات 911 المستجاب لها" required>
                </div>
                <div class="sub-section">
                    <label for="canceled_reports_911">اجمالي بلاغات 911 الملغاة:</label>
                    <input type="number" id="canceled_reports_911" placeholder="اجمالي بلاغات 911 الملغاة" required>
                </div>
                <div class="sub-section">
                    <h3>بلاغات (911) الملغاة:</h3>
                    <table id="canceled_reports_table">
                        <thead>
                            <tr>
                                <th>سبب الإلغاء</th>
                                <th>العدد</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>مكرر مع ذكر رقم البلاغ</td>
                                <td><input type="number" placeholder="العدد" required></td>
                            </tr>
                            <tr>
                                <td>ألغي من قبل جهة حكومية</td>
                                <td><input type="number" placeholder="العدد" required></td>
                            </tr>
                            <tr>
                                <td>ألغي من قبل المبلغ لعدم الحاجة لنقل اسعافي</td>
                                <td><input type="number" placeholder="العدد" required></td>
                            </tr>
                            <tr>
                                <td>بلاغ غير اسعافي من قبل مركز العمليات الأمنية الموحدة</td>
                                <td><input type="number" placeholder="العدد" required></td>
                            </tr>
                            <tr>
                                <td>أسباب أخرى</td>
                                <td><input type="number" placeholder="العدد" required></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="form-section">
                <h3>أهداف المناوبة:</h3>
                <table>
                    <thead>
                        <tr>
                            <th>الهدف</th>
                            <th>التحديث</th>
                        </tr>
                    </thead>
                    <tbody id="shift_goals_medical">
                        <tr>
                            <td><input type="text" placeholder="الهدف" required></td>
                            <td><input type="text" placeholder="التحديث" required></td>
                        </tr>
                        <tr>
                            <td><input type="text" placeholder="الهدف" required></td>
                            <td><input type="text" placeholder="التحديث" required></td>
                        </tr>
                        <!-- يمكن إضافة المزيد من الصفوف حسب الحاجة -->
                    </tbody>
                </table>
                <button type="button" onclick="addShiftGoalMedical()">إضافة هدف آخر</button>
            </div>
            <div class="form-section">
                <h3>ملاحظات المناوبة:</h3>
                <textarea id="shift_notes_medical" rows="4" placeholder="ملاحظات المناوبة" required></textarea>
            </div>
            <div class="form-section">
                <h3>الاسم:</h3>
                <input type="text" id="name_medical" placeholder="أدخل اسمك" required>
            </div>
            <button type="button" class="submit-btn" onclick="submitFormMedical()">إرسال النموذج</button>
        </div>

        <!-- يمكن إضافة نماذج أخرى هنا في المستقبل -->
    </div>

    <script>
        // تفعيل لوحة التحكم الجانبية
        const sidebar = document.getElementById('sidebar');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const menuItems = document.querySelectorAll('.sidebar ul li');
        const forms = document.querySelectorAll('.form-container');

        hamburgerBtn.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                // إزالة الفعالية من جميع العناصر
                menuItems.forEach(el => el.classList.remove('active'));
                // إضافة الفعالية للعناصر المحددة
                item.classList.add('active');

                // إخفاء جميع النماذج
                forms.forEach(form => form.style.display = 'none');
                // إظهار النموذج المحدد
                const formToShow = document.getElementById(item.getAttribute('data-form'));
                if (formToShow) {
                    formToShow.style.display = 'block';
                }
            });
        });

        // دالة لإضافة صف جديد في جدول أهداف المناوبة (النموذج الأول)
        function addShiftGoal() {
            const shiftGoals = document.getElementById('shift_goals');
            const newRow = document.createElement('tr');

            const goalCell = document.createElement('td');
            const goalInput = document.createElement('input');
            goalInput.type = 'text';
            goalInput.placeholder = 'الهدف';
            goalInput.required = true;
            goalCell.appendChild(goalInput);

            const updateCell = document.createElement('td');
            const updateInput = document.createElement('input');
            updateInput.type = 'text';
            updateInput.placeholder = 'التحديث';
            updateInput.required = true;
            updateCell.appendChild(updateInput);

            newRow.appendChild(goalCell);
            newRow.appendChild(updateCell);

            shiftGoals.appendChild(newRow);
        }

        // دالة لإضافة صف جديد في جدول أهداف المناوبة (النموذج الجديد)
        function addShiftGoalMedical() {
            const shiftGoals = document.getElementById('shift_goals_medical');
            const newRow = document.createElement('tr');

            const goalCell = document.createElement('td');
            const goalInput = document.createElement('input');
            goalInput.type = 'text';
            goalInput.placeholder = 'الهدف';
            goalInput.required = true;
            goalCell.appendChild(goalInput);

            const updateCell = document.createElement('td');
            const updateInput = document.createElement('input');
            updateInput.type = 'text';
            updateInput.placeholder = 'التحديث';
            updateInput.required = true;
            updateCell.appendChild(updateInput);

            newRow.appendChild(goalCell);
            newRow.appendChild(updateCell);

            shiftGoals.appendChild(newRow);
        }

        // دالة لإرسال النموذج عبر واتساب (النموذج الأول)
        function submitForm() {
            // التحقق من تعبئة جميع الحقول المطلوبة
            const requiredFields = document.querySelectorAll('#ambulanceTeam input[required], #ambulanceTeam textarea[required]');
            let allFieldsFilled = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.border = '2px solid #d63031';
                    allFieldsFilled = false;
                } else {
                    field.style.border = '1px solid #b2bec3';
                }
            });

            if (!allFieldsFilled) {
                alert("يرجى تعبئة جميع الحقول المطلوبة.");
                return;
            }

            // جمع البيانات من النموذج
            const data = {
                total_service_providers: document.getElementById('total_service_providers').value,
                employees: document.getElementById('employees').value,
                volunteers: document.getElementById('volunteers').value,
                total_operational_units: document.getElementById('total_operational_units').value,
                male_teams: document.getElementById('male_teams').value,
                mechanical_teams: document.getElementById('mechanical_teams').value,
                vehicle_teams: document.getElementById('vehicle_teams').value,
                team_distribution: {
                    haram: document.getElementById('haram').value,
                    holy_capital: document.getElementById('holy_capital').value,
                    muzdalifah: document.getElementById('muzdalifah').value,
                    arafat: document.getElementById('arafat').value,
                    mina: document.getElementById('mina').value,
                    hajj_road: document.getElementById('hajj_road').value
                },
                shift_goals: [],
                shift_notes: document.getElementById('shift_notes').value,
                name: document.getElementById('name').value
            };

            // جمع أهداف المناوبة
            const goals = document.querySelectorAll('#shift_goals tr');
            goals.forEach(row => {
                const goalInput = row.cells[0].querySelector('input');
                const updateInput = row.cells[1].querySelector('input');
                if (goalInput.value.trim() !== '' && updateInput.value.trim() !== '') {
                    const goal = goalInput.value.trim();
                    const update = updateInput.value.trim();
                    data.shift_goals.push({ goal, update });
                }
            });

            // إنشاء نص الرسالة لواتساب
            let formText = `*== فريق الإسعاف الارضي ==*\n\n`;
            formText += `*إجمالي مقدمي الخدمة الإسعافية:* ${data.total_service_providers}\n`;
            formText += `*الموظفين منهم:* ${data.employees}\n`;
            formText += `*المتطوعين منهم:* ${data.volunteers}\n`;
            formText += `*إجمالي الوحدات التشغيلية:* ${data.total_operational_units}\n`;
            formText += `*فرق راجلة:* ${data.male_teams}\n`;
            formText += `*فرق آليات:* ${data.mechanical_teams}\n`;
            formText += `*فرق مركبات:* ${data.vehicle_teams}\n\n`;

            formText += `*توزيع الفرق بحسب مواقعها:*\n`;
            formText += `- الحرم المكي: ${data.team_distribution.haram}\n`;
            formText += `- العاصمة المقدسة: ${data.team_distribution.holy_capital}\n`;
            formText += `- مزدلفة: ${data.team_distribution.muzdalifah}\n`;
            formText += `- عرفات: ${data.team_distribution.arafat}\n`;
            formText += `- منى: ${data.team_distribution.mina}\n`;
            formText += `- طريق الحاج: ${data.team_distribution.hajj_road}\n\n`;

            formText += `*أهداف المناوبة:*\n`;
            data.shift_goals.forEach((goalObj, index) => {
                formText += `${index + 1}- الهدف: ${goalObj.goal}\n   التحديث: ${goalObj.update}\n`;
            });
            formText += `\n*ملاحظات المناوبة:* ${data.shift_notes}\n`;
            formText += `*الاسم:* ${data.name}\n`;

            console.log(formText); // تأكيد عرض البيانات المجمعة

            // تشفير النص
            const encodedText = encodeURIComponent(formText);

            // التحقق من نوع الجهاز أو المتصفح
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                // على أجهزة iOS، استخدم رابط واتساب المباشر
                const whatsappUrl = `whatsapp://send?text=${encodedText}`;
                window.open(whatsappUrl, '_blank');
            } else {
                // على باقي الأجهزة، استخدم wa.me لفتح الرابط
                const whatsappUrl = `https://wa.me/?text=${encodedText}`;
                window.open(whatsappUrl, '_blank');
            }
        }

        // دالة لإرسال النموذج عبر واتساب (النموذج الجديد)
        function submitFormMedical() {
            // التحقق من تعبئة جميع الحقول المطلوبة
            const requiredFields = document.querySelectorAll('#medicalTransferTeam input[required], #medicalTransferTeam textarea[required]');
            let allFieldsFilled = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.border = '2px solid #d63031';
                    allFieldsFilled = false;
                } else {
                    field.style.border = '1px solid #b2bec3';
                }
            });

            if (!allFieldsFilled) {
                alert("يرجى تعبئة جميع الحقول المطلوبة.");
                return;
            }

            // جمع البيانات من النموذج
            const data = {
                total_calls: document.getElementById('total_calls').value,
                received_calls: document.getElementById('received_calls').value,
                missed_calls_percentage: document.getElementById('missed_calls_percentage').value,
                reports_997: document.getElementById('reports_997').value,
                reports_911: document.getElementById('reports_911').value,
                reports_apps: document.getElementById('reports_apps').value,
                patients_responsive: document.getElementById('patients_responsive').value,
                shift_goals: [],
                shift_notes: document.getElementById('shift_notes_medical').value,
                name: document.getElementById('name_medical').value,
                total_reports_911: document.getElementById('total_reports_911').value,
                responded_reports_911: document.getElementById('responded_reports_911').value,
                canceled_reports_911: document.getElementById('canceled_reports_911').value
            };

            // جمع أهداف المناوبة
            const goals = document.querySelectorAll('#shift_goals_medical tr');
            goals.forEach(row => {
                const goalInput = row.cells[0].querySelector('input');
                const updateInput = row.cells[1].querySelector('input');
                if (goalInput.value.trim() !== '' && updateInput.value.trim() !== '') {
                    const goal = goalInput.value.trim();
                    const update = updateInput.value.trim();
                    data.shift_goals.push({ goal, update });
                }
            });

            // جمع بيانات مؤشرات الترحيل الطبي
            const indicatorsRows = document.querySelectorAll('#indicators_table tbody tr');
            data.indicators = [];
            indicatorsRows.forEach(row => {
                if (row.cells.length >= 3) { // التأكد من وجود ثلاث خلايا
                    const team = row.cells[0].textContent.trim();
                    const received = row.cells[1].querySelector('input').value;
                    const canceled = row.cells[2].querySelector('input').value;
                    data.indicators.push({ team, received, canceled });
                }
            });

            // جمع بيانات بلاغات (911) الملغاة
            const canceledReportsRows = document.querySelectorAll('#canceled_reports_table tbody tr');
            data.canceled_reports = [];
            canceledReportsRows.forEach(row => {
                if (row.cells.length >= 2) { // التأكد من وجود خليتين
                    const reason = row.cells[0].textContent.trim();
                    const count = row.cells[1].querySelector('input').value;
                    data.canceled_reports.push({ reason, count });
                }
            });

            // إنشاء نص الرسالة لواتساب
            let formText = `*== فريق الترحيل الطبي ==*\n\n`;
            formText += `*إجمالي المكالمات:* ${data.total_calls}\n`;
            formText += `*المكالمات المستلمة:* ${data.received_calls}\n`;
            formText += `*نسبة المكالمات الفائتة:* ${data.missed_calls_percentage}\n\n`;

            formText += `*بلاغات:*\n`;
            formText += `- بلاغات 997: ${data.reports_997}\n`;
            formText += `- بلاغات 911: ${data.reports_911}\n`;
            formText += `- بلاغات التطبيقات: ${data.reports_apps}\n\n`;

            formText += `*عدد المرضى المستجاب لهم:* ${data.patients_responsive}\n\n`;

            formText += `*التطبيقات:* المسعف الإلكتروني توكلنا، أسعفني، صحتي، عقد\n\n`;

            formText += `*مؤشرات الترحيل الطبي:*\n`;
            formText += `إجمالي عدد البلاغات للعاصمة المقدسة والحرم والمشاعر حسب تصنيف الترحيل الطبي.\n\n`;

            formText += `\n*التصنيفات:*\n`;
            data.indicators.forEach((indicator, index) => {
                formText += `- ${indicator.team}: مستلمة ${indicator.received}, ملغاة ${indicator.canceled}\n`;
            });
            formText += `\n*نسبة الالتزام ProQA:* ${document.getElementById('proqa_percentage').value}\n`;
            formText += `*نسبة المكالمات التي تم معالجتها خلال 90 ثانية:* ${document.getElementById('processed_calls_percentage').value}\n`;
            formText += `*نسبة بلاغات VECTOR من اجمالي البلاغات:* ${document.getElementById('vector_reports_percentage').value}\n\n`;

            formText += `*بلاغات 911:* \n`;
            formText += `- إجمالي البلاغات الواردة من 911: ${data.total_reports_911}\n`;
            formText += `- اجمالي بلاغات 911 المستجاب لها: ${data.responded_reports_911}\n`;
            formText += `- اجمالي بلاغات 911 الملغاة: ${data.canceled_reports_911}\n\n`;

            formText += `*بلاغات (911) الملغاة:*\n`;
            data.canceled_reports.forEach((report, index) => {
                formText += `- سبب الإلغاء: ${report.reason}: ${report.count}\n`;
            });
            formText += `\n*أهداف المناوبة:*\n`;
            data.shift_goals.forEach((goalObj, index) => {
                formText += `${index + 1}- الهدف: ${goalObj.goal}\n   التحديث: ${goalObj.update}\n`;
            });
            formText += `\n*ملاحظات المناوبة:* ${data.shift_notes}\n`;
            formText += `*الاسم:* ${data.name}\n`;

            console.log(formText); // تأكيد عرض البيانات المجمعة

            // تشفير النص
            const encodedText = encodeURIComponent(formText);

            // التحقق من نوع الجهاز أو المتصفح
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                // على أجهزة iOS، استخدم رابط واتساب المباشر
                const whatsappUrl = `whatsapp://send?text=${encodedText}`;
                window.open(whatsappUrl, '_blank');
            } else {
                // على باقي الأجهزة، استخدم wa.me لفتح الرابط
                const whatsappUrl = `https://wa.me/?text=${encodedText}`;
                window.open(whatsappUrl, '_blank');
            }
        }

        // إظهار النموذج الافتراضي عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            // إظهار النموذج الافتراضي
            const defaultForm = document.querySelector('.sidebar ul li.active');
            if (defaultForm) {
                const formId = defaultForm.getAttribute('data-form');
                const formToShow = document.getElementById(formId);
                if (formToShow) {
                    formToShow.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>
