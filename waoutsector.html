<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحليل الرسائل وفرز البيانات</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .input-section {
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            resize: none;
        }
        button {
            padding: 10px 20px;
            background-color: #3498db;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
        }
        button:hover {
            background-color: #1d6a9c;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>

    <h2>تحليل الرسائل وفرز البيانات</h2>

    <div class="input-section">
        <textarea id="messages" placeholder="الصق الرسائل هنا..."></textarea>
        <button onclick="processMessages()">تحليل الرسائل</button>
    </div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>القطاع</th>
                <th>التاريخ</th>
                <th>الوقت</th>
                <th>كبير المسعفين</th>
                <th>عدد الفرق العاملة</th>
                <th>عدد المركبات العاملة</th>
                <th>عدد المركبات المتعطلة</th>
                <th>عدد البلاغات</th>
                <th>عدد الغياب</th>
                <th>ملاحظات الكاد</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function processMessages() {
            const messages = document.getElementById('messages').value.split('[٢');
            const resultTableBody = document.querySelector("#resultTable tbody");
            resultTableBody.innerHTML = ''; // Clear previous results

            messages.forEach(message => {
                if (message.trim() === '') return;

                const sectorMatch = message.match(/قطاع محافظة \((.+?)\)/);
                const dateMatch = message.match(/\d{4}\/\d{2}\/\d{2}/);
                const timeMatch = message.match(/الساعة: (.+?) إلى (.+?)(\n|$)/);
                const supervisorMatch = message.match(/كبير المسعفين المناوب:\n?(.+)/);
                const workingTeamsMatch = message.match(/عدد الفرق العاملة:\((\d+) من أصل (\d+)\)/);
                const vehiclesWorkingMatch = message.match(/عدد المركبات العاملة: (\d+)/);
                const vehiclesBrokenMatch = message.match(/عدد المركبات المتعطلة: (\d+)/);
                const reportsMatch = message.match(/عدد البلاغات: (\d+)/);
                const absenceMatch = message.match(/عدد الغياب في المناوبة:\n?\(?\s?(.+?)\s?\)?\n/);
                const cadNotesMatch = message.match(/ملاحظات برنامج الكاد :\n?(1-.+?)(\n|$)/);

                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${sectorMatch ? sectorMatch[1] : 'غير متوفر'}</td>
                    <td>${dateMatch ? dateMatch[0] : 'غير متوفر'}</td>
                    <td>${timeMatch ? timeMatch[1] + ' إلى ' + timeMatch[2] : 'غير متوفر'}</td>
                    <td>${supervisorMatch ? supervisorMatch[1].trim() : 'غير متوفر'}</td>
                    <td>${workingTeamsMatch ? workingTeamsMatch[1] : 'غير متوفر'}</td>
                    <td>${vehiclesWorkingMatch ? vehiclesWorkingMatch[1] : 'غير متوفر'}</td>
                    <td>${vehiclesBrokenMatch ? vehiclesBrokenMatch[1] : 'غير متوفر'}</td>
                    <td>${reportsMatch ? reportsMatch[1] : 'غير متوفر'}</td>
                    <td>${absenceMatch ? absenceMatch[1] : 'غير متوفر'}</td>
                    <td>${cadNotesMatch ? cadNotesMatch[1].trim() : 'غير متوفر'}</td>
                `;

                resultTableBody.appendChild(row);
            });
        }
    </script>

</body>
</html>
