<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐คูุฑูุจ ููุงุฏุงุช ุงูุฑูุงุถ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: center;
            background-color: white;
            color: #333;
        }
        h1 {
            color: #2196F3; /* ููู ุฃุฒุฑู */
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 0px 0px 5px #2196F3;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        textarea {
            width: 80%;
            height: 150px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #2196F3;
            padding: 10px;
            font-size: 1em;
            background-color: white;
            color: #333;
            resize: none;
            box-shadow: 0px 0px 10px #2196F3;
        }
        button {
            background-color: #2196F3; /* ููู ุฃุฒุฑู */
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            transition: 0.3s;
            box-shadow: 0px 0px 15px #2196F3;
        }
        button:hover {
            background-color: #1976D2; /* ููู ุฃุฒุฑู ุฏุงูู ุนูุฏ ุงูุชุญููู */
            box-shadow: 0px 0px 20px #1976D2;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0px 0px 20px #2196F3;
        }
        table, th, td {
            border: 1px solid #2196F3; /* ููู ุฃุฒุฑู */
        }
        th, td {
            padding: 10px;
            text-align: center;
            color: #2196F3;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        .instruction {
            font-size: 1em;
            color: #2196F3;
            margin-bottom: 15px;
            text-shadow: 0px 0px 5px #2196F3;
        }
        .hidden {
            display: none;
        }
        footer {
            margin-top: 30px;
            font-size: 0.8em;
            color: red;
            text-shadow: 1px 1px 2px #000;
            text-align: center;
        }
        footer a {
            color: #2196F3;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
        .version {
            font-size: 0.9em;
            color: #555;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1> ุจุฑูุฌุฉ ุงูุฃุฏุงุฉ ููุฅุณุชุฎุฏุงู ุงูุดุฎุตู ููุท ๐ช </h1>

    <div class="container">
        <label class="instruction">ุฃุฏุฎู ุฑุณุงุฆู ูุจุงุฑ ุงููุณุนููู ููุง:</label>
        <textarea id="dataInput" placeholder="ุงูุตู ุงูุฑุณุงุฆู ููุง..."></textarea>
        <button onclick="processData()">ุชูุธูู ุงูุจูุงูุงุช</button>
    </div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>ุงููุทุงุน</th>
                <th>ุงูุชุงุฑูุฎ</th>
                <th>ูู ุงูุณุงุนุฉ</th>
                <th>ุฅูู ุงูุณุงุนุฉ</th>
                <th>ูู</th> <!-- ุงููุฑุน ุงูุฃูู -->
                <th>ุฅูู</th> <!-- ุงููุฑุน ุงูุซุงูู -->
                <th>ุนุฏุฏ ูุฑู ุงูุชุฏุฎู ุงูุณุฑูุน</th>
                <th>ุนุฏุฏ ุงููุฑูุจุงุช ุงูุนุงููุฉ</th>
                <th>ุนุฏุฏ ุงููุฑูุจุงุช ุงููุชุนุทูุฉ</th>
                <th>ุจูุงุบุงุช ุงูุฏุนู ุงูููุฌุณุชู ุงูููุชูุญุฉ</th>
                <th>ุนุฏุฏ ุงูุนุงูููู ูู ุงูุชูุณูู ูุงูุชุญูู</th>
                <th>ุนุฏุฏ ุงูุนุงูููู ูู ุงูุฏุนู ุงูููุฌุณุชู</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <button id="copyButton" class="hidden" onclick="copyTableData()">ูุณุฎ ุงูุจูุงูุงุช</button> <!-- ุฒุฑ ุงููุณุฎ -->

    <footer>
        <a href="https://xcoder-sa.github.io/indicators/kpi.html">๐ถ</a>
        <br><br>
        <span>&lt; / &gt; Design and Development by Ali Alshahrani &lt;  &gt;</span>
        <div class="version">ุฅุตุฏุงุฑ ุงููุณุฎุฉ: 1.3.9</div> <!-- ุชุญุฏูุซ ุฑูู ุงูุฅุตุฏุงุฑ -->
    </footer>

    <script>
        function processData() {
            let input = document.getElementById("dataInput").value;

            // ุชุญููู ุฌููุน ุฃููุงุท ุงูุชูุงููุช ุงููุฎุชููุฉ ุฅูู ุตูุบุฉ ููุญุฏุฉ HH:MM
            input = input.replace(/ุงูุณุงุนุฉ[: ]?\s*(\d{1,2})[: ]?\s*(\d{2})\s*(?:ุฅูู|ุงูู|:|[-*])[: ]?\s*(\d{1,2})[: ]?\s*(\d{2})/g, (match, h1, m1, h2, m2) => {
                return `ุงูุณุงุนุฉ ${h1.padStart(2, '0')}:${m1.padStart(2, '0')} ุฅูู ${h2.padStart(2, '0')}:${m2.padStart(2, '0')}`;
            });

            // ุฅุถุงูุฉ "----" ูุจู ูู ุณุทุฑ ูุญุชูู ุนูู "ูุทุงุน ("
            input = input.replace(/(ูุทุงุน\s*\(|[*]ูุทุงุน.*[*])/g, "----\n$1");

            const rows = input.split("----");

            const tableBody = document.querySelector("#dataTable tbody");
            tableBody.innerHTML = ""; // ุชูุฑูุบ ุงูุฌุฏูู

            let data = [];

            rows.forEach(row => {
                const sectorData = parseSectorData(row);
                if (sectorData) {
                    data.push(sectorData);
                }
            });

            // ูุฑุฒ ุงูุจูุงูุงุช ุญุณุจ ุงูุชุงุฑูุฎ ูุงูููุช
            data.sort((a, b) => {
                const dateA = new Date(formatDate(a[1]) + " " + a[2]);
                const dateB = new Date(formatDate(b[1]) + " " + b[2]);
                return dateA - dateB;
            });

            // ุฅูุดุงุก ุงูุตููู ุจุนุฏ ุงููุฑุฒ
            data.forEach(sectorData => {
                // ุชุญูู ูู ุนุฏุฏ ูุฑุงุช ุธููุฑ "ุบูุฑ ูุชููุฑ" ูู ุงูุฃุนูุฏุฉ ุงููุญุฏุฏุฉ
                const columnsToCheck = [4, 5, 6, 7, 8, 9, 10];
                let unavailableCount = 0;
                columnsToCheck.forEach(index => {
                    if (sectorData[index] === "ุบูุฑ ูุชููุฑ") {
                        unavailableCount++;
                    }
                });
                // ุฅุฐุง ูุงูุช "ุบูุฑ ูุชููุฑ" ูู ุฃูุซุฑ ูู ุฎููุฉุ ุชุฌุงูู ุงูุตู
                if (unavailableCount > 1 || sectorData[0] === "ุงููุดุบููุฉ ูุงููุชุงุญุฉ") {
                    return;
                }

                const tr = document.createElement("tr");
                sectorData.forEach(dataItem => {
                    const td = document.createElement("td");
                    td.textContent = dataItem || "ุบูุฑ ูุชููุฑ";
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });

            // ุฅุธูุงุฑ ุฒุฑ ุงููุณุฎ ููุท ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช
            const copyButton = document.getElementById("copyButton");
            if (data.length > 0) {
                copyButton.classList.remove("hidden");
            } else {
                copyButton.classList.add("hidden");
            }
        }

        function parseSectorData(text) {
            // ูุงุฆูุฉ ุงููุทุงุนุงุช ุงููุณููุญ ุจูุง
            const validSectors = ["ุงูุฌููุจ", "ุงูุบุฑุจ", "ุงูุดุฑู", "ุงููุณุท", "ุงูุดูุงู"];
            
            // ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงููุฑุณู ูุงูุชุงุฑูุฎ ูุงูููุช
            let sectorMatch = text.match(/ูุทุงุน\s*\((.*?)\)|[*]ูุทุงุน\s*(.*?)\s*[*]/); // ุงุณุชุฎุฑุงุฌ ุงููุทุงุน
            if (sectorMatch) {
                let sectorName = sectorMatch[1] || sectorMatch[2];
                // ุฅุฒุงูุฉ ุฃู ุฑููุฒ ุฃู ูุณุงูุงุช ุฒุงุฆุฏุฉ ูู ุงุณู ุงููุทุงุน
                sectorName = sectorName.replace(/[^\p{L}\p{N}\s]/gu, '').trim();
                // ุงูุชุญูู ูู ุตุญุฉ ุงุณู ุงููุทุงุน
                if (!validSectors.includes(sectorName)) {
                    return null; // ุชุฌุงูู ุงูุตู ุฅุฐุง ูุงู ุงููุทุงุน ุบูุฑ ุตุญูุญ
                }
            }

            const dateMatch = text.match(/\d{4}\/\d{2}\/\d{2}|\d{2}-\d{2}-\d{4}/);
            const timeMatch = text.match(/ุงูุณุงุนุฉ\s*(\d{2}:\d{2})\s*(?:ุฅูู|ุงูู|:|[-*])[: ]?\s*(\d{2}:\d{2})/); // ุงุณุชุฎุฑุงุฌ ุงูุชูููุช ุงูููุญุฏ ูุน ูุงูุฉ ุงูุฃููุงุท
            // ุงุณุชุฎุฑุงุฌ ุนุฏุฏ ุงููุฑู ุงูุนุงููุฉ ููุตู ุงูููู ูู "ูู" ู"ุฅูู"
            const teamsMatch = text.match(/ุนุฏุฏ ุงููุฑู ุงูุนุงููุฉ[: ]*(?:\(*\s*(\d+)\s*\)*\s*)?ูู ุฃุตู[: ]*(?:\(*\s*(\d+)\s*\)?)?/) || 
                              text.match(/ุนุฏุฏ ุงููุฑู ุงูุนุงููุฉ[: ]*(\d+)[ ]*ูู[ ]*ุงุตู[: ]*(\d+)/i);
            const rapidTeamsMatch = text.match(/ุนุฏุฏ ูุฑู ุงูุชุฏุฎู ุงูุณุฑูุน[: ]*(\d+)/);
            const vehiclesWorkingMatch = text.match(/ุนุฏุฏ ุงููุฑูุจุงุช ุงูุนุงููุฉ[: ]*(\d+)/);
            const vehiclesBrokenMatch = text.match(/ุนุฏุฏ ุงููุฑูุจุงุช ุงููุชุนุทูุฉ[: ]*(\d+)/);
            const logisticReportsMatch = text.match(/ุจูุงุบุงุช ุงูุฏุนู ุงูููุฌุณุชู ุงูููุชูุญุฉ[: ]*(\d+)/) || [null, "0"];
            const controlStaffMatch = text.match(/ุนุฏุฏ ุงูุนุงูููู ูู ุงูุชูุณูู ูุงูุชุญูู[: ]*(\d+)/);
            const logisticStaffMatch = text.match(/ุนุฏุฏ ุงูุนุงูููู ูู ุงูุฏุนู ุงูููุฌุณุชู[: ]*(\d+)/);

            if (sectorMatch && dateMatch) {
                let sectorName = sectorMatch[1] || sectorMatch[2];
                sectorName = sectorName.replace(/[^\p{L}\p{N}\s]/gu, '').trim(); // ุชูุธูู ุงุณู ุงููุทุงุน

                const teamsFrom = teamsMatch ? teamsMatch[1] : "ุบูุฑ ูุชููุฑ";
                const teamsTo = teamsMatch ? teamsMatch[2] : "ุบูุฑ ูุชููุฑ";

                return [
                    sectorName,  // ุงุณู ุงููุทุงุน
                    dateMatch[0],
                    timeMatch ? timeMatch[1] : "ุบูุฑ ูุชููุฑ",
                    timeMatch ? timeMatch[2] : "ุบูุฑ ูุชููุฑ",
                    teamsFrom, // ุงูุนููุฏ "ูู"
                    teamsTo,   // ุงูุนููุฏ "ุฅูู"
                    rapidTeamsMatch ? rapidTeamsMatch[1] : "ุบูุฑ ูุชููุฑ",
                    vehiclesWorkingMatch ? vehiclesWorkingMatch[1] : "ุบูุฑ ูุชููุฑ",
                    vehiclesBrokenMatch ? vehiclesBrokenMatch[1] : "ุบูุฑ ูุชููุฑ",
                    logisticReportsMatch ? logisticReportsMatch[1] : "0",
                    controlStaffMatch ? controlStaffMatch[1] : "ุบูุฑ ูุชููุฑ",
                    logisticStaffMatch ? logisticStaffMatch[1] : "ุบูุฑ ูุชููุฑ"
                ];
            }
            return null;
        }

        function formatDate(date) {
            if (date.includes("-") || date.includes("/")) {
                const parts = date.split(/[-\/]/);
                if (parts[0].length === 4) { // ุตูุบุฉ YYYY-MM-DD
                    return `${parts[0]}/${parts[1]}/${parts[2]}`;
                } else { // ุตูุบุฉ DD-MM-YYYY
                    return `${parts[2]}/${parts[1]}/${parts[0]}`;
                }
            }
            return date;
        }

        // ุชุนุฏูู ูุธููุฉ ูุณุฎ ุงูุฌุฏูู ูุชุฌุงูู ุงูููุฏุฑ ููุณุฎ ููุท ุงูุจูุงูุงุช
        function copyTableData() {
            const table = document.querySelector("#dataTable tbody"); // ูุณุฎ ุงูุฌุณู ููุท ุจุฏูู ุงูููุฏุฑ
            const range = document.createRange();
            range.selectNodeContents(table); // ุชุญุฏูุฏ ุงููุญุชูู ูู ุงูุฌุฏูู ุจุฏูู ุงูููุฏุฑ
            const selection = window.getSelection();
            selection.removeAllRanges(); // ุฅุฒุงูุฉ ุฃู ุชุญุฏูุฏ ุณุงุจู
            selection.addRange(range); // ุชุญุฏูุฏ ุงููุญุชูู ุงูุฌุฏูุฏ
            document.execCommand("copy"); // ูุณุฎ ุงููุญุชูู
            selection.removeAllRanges(); // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ุจุนุฏ ุงููุณุฎ
            alert("ุชู ูุณุฎ ุงูุจูุงูุงุช ุจูุฌุงุญ!"); // ุฑุณุงูุฉ ุชุฃููุฏ
        }
    </script>

</body>
</html>
